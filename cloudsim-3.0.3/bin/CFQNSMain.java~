package cmsfinitequeuenostag;


import org.cloudbus.cloudsim.*;
import org.cloudbus.cloudsim.core.CloudSim;

import java.io.FileWriter;
import java.io.IOException;
import java.util.Calendar;
import java.util.List;

/**
 * Created by dangbk on 16/04/2015.
 */
public class CFQNSMain {
    public static double[] muy = {0.2,0.02};
    public static double[] alpha = {0.01,0.001};//, 0.001};//,0.5, 1, 5, 10, 20, 50, 100, 150, 200};
    public static int[] capacity = {50};//, 3000, 2000, 1000};
    public static void chayvoilamdathaydoimultiqueues() throws IOException {
         // file luu kq


        // // co dinh alpha, lamda thay doi

        boolean hasTimeInitQueue = true; // thay doi cai nay phai thay doi ham init() trong file datacenter

        double[] lamdaarray = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20};
        int n = lamdaarray.length;

        double[] meanWaittimeNoMiddle = new double[n];
        double[] meanNumberSetupServerNoMidle = new double[n];
        double[] meanNumberOnServerNoMidle = new double[n];

        double[] meanWaittime = new double[n];
        double[] meanResponsetime = new double[n];
        int[] numberONTurnoff = new int[n];
        int[] numberOfQueue = new int[n];
        double[] meanNumberSetupServer = new double[n];
        double[] meanNumberOnServer = new double[n];
        double[] meanNumberMiddleServer = new double[n];
        double[] meanNumberOffToMiddleServer = new double[n];
        double[] timenextlist = new double[n];
        double[] jobLostRatio = new double[n];

        for (int indexMuy = 0; indexMuy < muy.length; indexMuy++) {
            for (int j = 0; j < alpha.length; j++) {

                for (int indexK = 0; indexK < capacity.length; indexK++) {

                    // cho lambda thay doi
                    for (int i = 0; i < lamdaarray.length; i++) {

                        // chay co middle
                        // chay voi co control middle
                        System.out.println("(with middle) Starting simulation... chay voi alpha = " + alpha[j]
                               +" muy = "+ muy[indexMuy]+ " capacity = "+capacity[indexK] + " lamda = " + lamdaarray[i]);
                        try {
                            //------------------thiet lap tham so-----------------
                            CFQNSHelper.reset();
                            CFQNSHelper.setAlpha(alpha[j]);
                            CFQNSHelper.jobsqueuecapacity = capacity[indexK];
                            CFQNSHelper.jobsqueuethresholdup = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrUP);
                            CFQNSHelper.jobsqueuethresholddown = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrDown);
                            CFQNSHelper.setMuy(muy[indexMuy]); // thoi gian phuc vu 1/ muy = 5
                            CFQNSHelper.setTimeOffToMiddle(200);

                            CFQNSHelper.setLamda(lamdaarray[i]);
//                    CMSHelper.setControlTime(200);

//                        // thay doi thoi gian thu nghiem cho phu hop voi lambda
//                        CFQNSHelper.timeStartSimulate = CFQNSHelper.timeStartSimulate / lamdaarray[i];
//                        CFQNSHelper.totalTimeSimulate = CFQNSHelper.totalTimeSimulate / lamdaarray[i];

                            boolean hasMiddle = true;

                            calculatetimenext();
                            //^^^^^^^^^^^^^^thiet lap tham so (end)^^^^^^^^^^^^^^^

                            // First step: Initialize the CloudSim package. It should be called
                            // before creating any entities.
                            int num_user = 1;   // number of cloud users
                            Calendar calendar = Calendar.getInstance();
                            boolean trace_flag = false;  // mean trace events

                            // Initialize the CloudSim library
                            CloudSim.init(num_user, calendar, trace_flag);

                            // Second step: Create Datacenters
                            //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                            CFQNSDatacenter datacenter0 = CFQNSHelper.createDatacenter("Datacenter_0");
                            datacenter0.state = CFQNSDatacenter.ON;
                            datacenter0.setStartState(0,(int) (CFQNSHelper.timeOffToMiddle/CFQNSHelper.timenext));
                            datacenter0.setHasMiddle(hasMiddle);
                            Log.printLine("main datacenter id "+datacenter0.getId());


                            //Third step: Create Broker
                            DatacenterBroker broker = CFQNSHelper.createBroker();


                            int brokerId = broker.getId();

                            // Sixth step: Starts the simulation
                            double lastclock = CloudSim.startSimulation();
                            // Final step: Print results when simulation is over
                            List<Cloudlet> newList = broker.getCloudletReceivedList();

                            CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                            System.out.println();
                            System.out.println();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                            System.out.println("total time simulate: " + lastclock);
                            System.out.println("(with middle) mean waitting time: " + ((CFQNSBroker) broker).getMeanWaittingTime());
                            System.out.println("(with middle) mean response time: " + ((CFQNSBroker) broker).getMeanResponseTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

//                            System.out.println("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                            System.out.println("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                            System.out.println("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                            System.out.println("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                            System.out.println("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                            System.out.println("number of job (trong khoang thoi gian xet: " + ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("**** total job lost: " + datacenter0.getNumberOfJobLost());
                            System.out.println("**** ti le job lost = joblost / numberofjob: " + datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("total vm: " + CFQNSHelper.getVmid());
                            System.out.println("total sub datacenter create: " + CFQNSHelper.listSubDatacenter.size());
                            System.out.println("so lan tat may ON  " + CFQNSHelper.extraCount);
                            System.out.println();


                            meanNumberMiddleServer[i] = datacenter0.getMeanMiddleServerLength();
                            meanNumberOnServer[i] = datacenter0.getMeanNumberOnServer();
                            meanNumberSetupServer[i] = datacenter0.getMeanNumberSetupServer();

                            meanNumberOffToMiddleServer[i] = CFQNSHelper.timeOffToMiddle / CFQNSHelper.timenext;
                            timenextlist[i] = CFQNSHelper.timenext;
                            jobLostRatio[i] = datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob();

                            meanWaittime[i] = ((CFQNSBroker) broker).getMeanWaittingTime();
                            meanResponsetime[i] = ((CFQNSBroker) broker).getMeanResponseTime();
                            numberONTurnoff[i] = CFQNSHelper.extraCount;
                            numberOfQueue[i] = CFQNSHelper.listSubDatacenter.size();


//                Log.printLine(CMSHelper.getWaittingTime(newList));

                        } catch (Exception e) {
                            e.printStackTrace();
                            Log.printLine("The simulation has been terminated due to an unexpected error");
                        }

                        //--------------------------------------- bo phan nay di doi voi infinite queue------------
                /*
                // chay khong co middle

                Log.printLine("(ko co middle) Starting simulation... chay voi lamda = ");
                try {
                    //------------------thiet lap tham so-----------------
                    CMSHelper.reset();
                    CMSHelper.setLamda(lamdaarray[i]);
//                    CMSHelper.setControlTime(200);
                    CMSHelper.setAlpha(alpha[j]);
                    CMSHelper.setMuy(0.2);


                    CMSHelper.setTimeOffToMiddle(200);

                    boolean hasMiddle = false;
//                    CMSHelper.totalJobs = 4100000;

                    //------------------thiet lap tham so (end)-----------------

                    // First step: Initialize the CloudSim package. It should be called
                    // before creating any entities.
                    int num_user = 1;   // number of cloud users
                    Calendar calendar = Calendar.getInstance();
                    boolean trace_flag = false;  // mean trace events

                    // Initialize the CloudSim library
                    CloudSim.init(num_user, calendar, trace_flag);

                    // Second step: Create Datacenters
                    //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                    CMSDatacenter datacenter0 = CMSHelper.createDatacenter("Datacenter_0");
//                    datacenter0.setStartState((int) (CMSHelper.lamda / CMSHelper.muy), 0);
                    datacenter0.setHasMiddle(hasMiddle);


                    //Third step: Create Broker
                    DatacenterBroker broker = CMSHelper.createBroker();

                    int brokerId = broker.getId();

                    // Sixth step: Starts the simulation
                    double lastclock = CloudSim.startSimulation();
                    // Final step: Print results when simulation is over
                    List<Cloudlet> newList = broker.getCloudletReceivedList();

                    CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                    Log.printLine();
                    Log.printLine();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                    Log.printLine("total time simulate: " + lastclock);
                    Log.printLine("(without middle) mean waitting time: " + ((CMSBroker) broker).getMeanWaittingTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

                    Log.printLine("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                    Log.printLine("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                    Log.printLine("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                    Log.printLine("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                    Log.printLine("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                    Log.printLine("total job: " + CMSHelper.getCloudletid());
                    Log.printLine("**** total job lost: " + datacenter0.getNumberOfJobLost());
                    Log.printLine("**** ti le job lost = joblost / numberofjob: "+datacenter0.getNumberOfJobLost()/((CMSBroker) broker).getNumberOfJob());
                    Log.printLine("total vm: " + CMSHelper.getVmid());
                    Log.printLine();

                    meanWaittimeNoMiddle[i] = ((CMSBroker) broker).getMeanWaittingTime();
                    meanNumberOnServerNoMidle[i] =datacenter0.getMeanNumberOnServer();
                    meanNumberSetupServerNoMidle[i] = datacenter0.getMeanNumberSetupServer();

//                Log.printLine(CMSHelper.getWaittingTime(newList));

                } catch (Exception e) {
                    e.printStackTrace();
                    Log.printLine("The simulation has been terminated due to an unexpected error");
                }

                //--------------------------------------- bo phan nay di doi voi infinite queue------------
            */
                    }


                    // in ket qua: voi h = h[j]
                    // ket qua co the copy vao matlab de ve
                    FileWriter fw = null;
                    System.out.println();
                    try {
                        fw = new FileWriter("results_CFQNS_no_stag_alpha_" + CFQNSHelper.alpha + "_capacity_"
                                + CFQNSHelper.jobsqueuecapacity + "_muy_" + CFQNSHelper.muy + "_thrUP_" + ((double) CFQNSHelper.jobsqueuethresholdup) / ((double) CFQNSHelper.jobsqueuecapacity)
                                + "_thrDown_" + ((double) CFQNSHelper.jobsqueuethresholddown) / ((double) CFQNSHelper.jobsqueuecapacity) + "_timeinitqueue_" + hasTimeInitQueue + ".txt");
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    fw.write("\n");
                    System.out.println("--------------------------------------");
                    fw.write("--------------------------------------\n");
                    fw.write("alpha = " + alpha[j] + "\n");
                    fw.write("\n");
                    System.out.println("close all");
                    fw.write("close all\n");

                    System.out.print("lamda = [");
                    fw.write("lamda = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", lamdaarray[i]);
                        fw.write(lamdaarray[i] + ", ");
                    }
                    System.out.printf("%.2f ];", lamdaarray[n - 1]);
                    fw.write(lamdaarray[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean waitting time = [");
                    fw.write("mean_waitting_time" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanWaittime[i]);
                        fw.write(meanWaittime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanWaittime[n - 1]);
                    fw.write(meanWaittime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean response time = [");
                    fw.write("mean_response_time" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanResponsetime[i]);
                        fw.write(meanResponsetime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanResponsetime[n - 1]);
                    fw.write(meanResponsetime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number middle server = [");
                    fw.write("mean_number_of_middle_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberMiddleServer[i]);
                        fw.write(meanNumberMiddleServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberMiddleServer[n - 1]);
                    fw.write(meanNumberMiddleServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number setup server = [");
                    fw.write("mean_number_of_setup_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberSetupServer[i]);
                        fw.write(meanNumberSetupServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberSetupServer[n - 1]);
                    fw.write(meanNumberSetupServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number On server = [");
                    fw.write("mean_number_of_on_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberOnServer[i]);
                        fw.write(meanNumberOnServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberOnServer[n - 1]);
                    fw.write(meanNumberOnServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number Off to Middle server = [");
                    fw.write("mean_number_of_off_to_middle_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberOffToMiddleServer[i]);
                        fw.write(meanNumberOffToMiddleServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberOffToMiddleServer[n - 1]);
                    fw.write(meanNumberOffToMiddleServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number turned off = [");
                    fw.write("mean_number_turned_off" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberONTurnoff[i]);
                        fw.write(numberONTurnoff[i] + ", ");
                    }
                    System.out.print(" ," + numberONTurnoff[n - 1]);
                    fw.write(numberONTurnoff[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("max number of queue = [");
                    fw.write("max_number_of_queue" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberOfQueue[i]);
                        fw.write(numberOfQueue[i] + ", ");
                    }
                    System.out.print(" ," + numberOfQueue[n - 1]);
                    fw.write(numberOfQueue[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("time next = [");
                    fw.write("time_next" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + timenextlist[i]);
                        fw.write(timenextlist[i] + ", ");
                    }
                    System.out.print(" ," + timenextlist[n - 1]);
                    fw.write(timenextlist[n - 1] + "];\n");


                    System.out.print("job lost ratio = [");
                    fw.write("job_lost_ratio"+CFQNSHelper.jobsqueuecapacity+" = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + jobLostRatio[i]);
                        fw.write(jobLostRatio[i] + ", ");
                    }
                    System.out.print(" ," + jobLostRatio[n - 1]);
                    fw.write(jobLostRatio[n - 1] + "];\n");


                    fw.write("\n_____________________________\n\n");
                    System.out.println();

                    //------------ ko co middle-------------
/*
            Log.print("mean Waittime No Middle = [");fw.write("mean_waitting_time_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanWaittimeNoMiddle[i]);fw.write(meanWaittimeNoMiddle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanWaittimeNoMiddle[n-1]);fw.write(meanWaittimeNoMiddle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number setup server no middle = [");fw.write("mean_number_of_setup_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberSetupServerNoMidle[i]);fw.write(meanNumberSetupServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberSetupServerNoMidle[n-1]);fw.write(meanNumberSetupServerNoMidle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number On server no middle = [");fw.write("mean_number_of_on_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberOnServerNoMidle[i]);fw.write(meanNumberOnServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberOnServerNoMidle[n-1]);fw.write(meanNumberOnServerNoMidle[n-1] + "];\n");
            Log.printLine();
*/


                    System.out.println();

                    // in code ve:
                    fw.write("plot(lamda,mean_waitting_time,'r',lamda,mean_waitting_time_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean waitting time');\n");
                    fw.write("legend('with middle','no middle');\n");
                    fw.write("ylim([0 max(max(mean_waitting_time),max(mean_waitting_time_no_middle))*10/9]);");

//            fw.write("ylim([0 18000]);\n");
                    fw.write("figure(2);\n");
                    fw.write("plot(lamda,mean_number_of_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number of middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_middle_server)*10/9]);");

                    fw.write("figure(3);\n");
                    fw.write("plot(lamda,mean_number_of_off_to_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number off to middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_off_to_middle_server)*10/9]);");

                    // ------ve do thi mean number of ON server va Setup server
                    fw.write("figure(4);\n");
                    fw.write("plot(lamda,mean_number_of_setup_server,'r',lamda,mean_number_of_setup_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number setup server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_setup_server),max(mean_number_of_setup_server_no_middle))*10/9]);");

                    fw.write("figure(5);\n");
                    fw.write("plot(lamda,mean_number_of_on_server,'r',lamda,mean_number_of_on_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number on server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_on_server),max(mean_number_of_on_server_no_middle))*10/9]);\n");
//            fw.write("ylim([0 1000]);\n");
                    System.out.println("--------------------------------------");
                    fw.write("--------------------------------------\n");
                    fw.close();
                }

            }
        }
    }

    public static void chayvoilamdathaydoisinglequeue() throws IOException {
        // file luu kq


        // // co dinh alpha, lamda thay doi

        boolean hasTimeInitQueue = true; // thay doi cai nay phai thay doi ham init() trong file datacenter

        double[] lamdaarray = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20};
        int n = lamdaarray.length;

        double[] meanWaittimeNoMiddle = new double[n];
        double[] meanNumberSetupServerNoMidle = new double[n];
        double[] meanNumberOnServerNoMidle = new double[n];

        double[] meanWaittime = new double[n];
        double[] meanResponsetime = new double[n];
        int[] numberONTurnoff = new int[n];
        int[] numberOfQueue = new int[n];
        double[] meanNumberSetupServer = new double[n];
        double[] meanNumberOnServer = new double[n];
        double[] meanNumberMiddleServer = new double[n];
        double[] meanNumberOffToMiddleServer = new double[n];
        double[] timenextlist = new double[n];
        double[] jobLostRatio = new double[n];

        for (int indexMuy = 0; indexMuy < muy.length; indexMuy++) {
            for (int j = 0; j < alpha.length; j++) {

                for (int indexK = 0; indexK < capacity.length; indexK++) {

                    // cho lambda thay doi
                    for (int i = 0; i < lamdaarray.length; i++) {

                        // chay co middle
                        // chay voi co control middle
                        System.out.println("(with middle) Starting simulation... chay voi alpha = " + alpha[j]
                                +" muy = "+ muy[indexMuy]+ " capacity = "+capacity[indexK] + " lamda = " + lamdaarray[i]);
                        try {
                            //------------------thiet lap tham so-----------------
                            CFQNSHelper.reset();
                            CFQNSHelper.setAlpha(alpha[j]);
                            CFQNSHelper.jobsqueuecapacity = capacity[indexK];
                            CFQNSHelper.jobsqueuethresholdup = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrUP);
                            CFQNSHelper.jobsqueuethresholddown = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrDown);
                            CFQNSHelper.setMuy(muy[indexMuy]); // thoi gian phuc vu 1/ muy = 5
                            CFQNSHelper.setTimeOffToMiddle(200);

                            CFQNSHelper.setLamda(lamdaarray[i]);
                            CFQNSHelper.isSingleQueue = true;
//                    CMSHelper.setControlTime(200);

//                        // thay doi thoi gian thu nghiem cho phu hop voi lambda
//                        CFQNSHelper.timeStartSimulate = CFQNSHelper.timeStartSimulate / lamdaarray[i];
//                        CFQNSHelper.totalTimeSimulate = CFQNSHelper.totalTimeSimulate / lamdaarray[i];

                            boolean hasMiddle = true;

                            calculatetimenext();
                            //^^^^^^^^^^^^^^thiet lap tham so (end)^^^^^^^^^^^^^^^

                            // First step: Initialize the CloudSim package. It should be called
                            // before creating any entities.
                            int num_user = 1;   // number of cloud users
                            Calendar calendar = Calendar.getInstance();
                            boolean trace_flag = false;  // mean trace events

                            // Initialize the CloudSim library
                            CloudSim.init(num_user, calendar, trace_flag);

                            // Second step: Create Datacenters
                            //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                            CFQNSDatacenter datacenter0 = CFQNSHelper.createDatacenter("Datacenter_0");
                            datacenter0.state = CFQNSDatacenter.ON;
                            datacenter0.setStartState(0,(int) (CFQNSHelper.timeOffToMiddle/CFQNSHelper.timenext));
                            datacenter0.setHasMiddle(hasMiddle);
                            Log.printLine("main datacenter id "+datacenter0.getId());


                            //Third step: Create Broker
                            DatacenterBroker broker = CFQNSHelper.createBroker();


                            int brokerId = broker.getId();

                            // Sixth step: Starts the simulation
                            double lastclock = CloudSim.startSimulation();
                            // Final step: Print results when simulation is over
                            List<Cloudlet> newList = broker.getCloudletReceivedList();

                            CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                            System.out.println();
                            System.out.println();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                            System.out.println("total time simulate: " + lastclock);
                            System.out.println("(with middle) mean waitting time: " + ((CFQNSBroker) broker).getMeanWaittingTime());
                            System.out.println("(with middle) mean response time: " + ((CFQNSBroker) broker).getMeanResponseTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

//                            System.out.println("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                            System.out.println("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                            System.out.println("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                            System.out.println("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                            System.out.println("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                            System.out.println("number of job (trong khoang thoi gian xet: " + ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("**** total job lost: " + datacenter0.getNumberOfJobLost());
                            System.out.println("**** ti le job lost = joblost / numberofjob: " + datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("total vm: " + CFQNSHelper.getVmid());
                            System.out.println("total sub datacenter create: " + CFQNSHelper.listSubDatacenter.size());
                            System.out.println("so lan tat may ON  " + CFQNSHelper.extraCount);
                            System.out.println();


                            meanNumberMiddleServer[i] = datacenter0.getMeanMiddleServerLength();
                            meanNumberOnServer[i] = datacenter0.getMeanNumberOnServer();
                            meanNumberSetupServer[i] = datacenter0.getMeanNumberSetupServer();

                            meanNumberOffToMiddleServer[i] = CFQNSHelper.timeOffToMiddle / CFQNSHelper.timenext;
                            timenextlist[i] = CFQNSHelper.timenext;
                            jobLostRatio[i] = datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob();

                            meanWaittime[i] = ((CFQNSBroker) broker).getMeanWaittingTime();
                            meanResponsetime[i] = ((CFQNSBroker) broker).getMeanResponseTime();
                            numberONTurnoff[i] = CFQNSHelper.extraCount;
                            numberOfQueue[i] = CFQNSHelper.listSubDatacenter.size();


//                Log.printLine(CMSHelper.getWaittingTime(newList));

                        } catch (Exception e) {
                            e.printStackTrace();
                            Log.printLine("The simulation has been terminated due to an unexpected error");
                        }

                        //--------------------------------------- bo phan nay di doi voi infinite queue------------
                /*
                // chay khong co middle

                Log.printLine("(ko co middle) Starting simulation... chay voi lamda = ");
                try {
                    //------------------thiet lap tham so-----------------
                    CMSHelper.reset();
                    CMSHelper.setLamda(lamdaarray[i]);
//                    CMSHelper.setControlTime(200);
                    CMSHelper.setAlpha(alpha[j]);
                    CMSHelper.setMuy(0.2);


                    CMSHelper.setTimeOffToMiddle(200);

                    boolean hasMiddle = false;
//                    CMSHelper.totalJobs = 4100000;

                    //------------------thiet lap tham so (end)-----------------

                    // First step: Initialize the CloudSim package. It should be called
                    // before creating any entities.
                    int num_user = 1;   // number of cloud users
                    Calendar calendar = Calendar.getInstance();
                    boolean trace_flag = false;  // mean trace events

                    // Initialize the CloudSim library
                    CloudSim.init(num_user, calendar, trace_flag);

                    // Second step: Create Datacenters
                    //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                    CMSDatacenter datacenter0 = CMSHelper.createDatacenter("Datacenter_0");
//                    datacenter0.setStartState((int) (CMSHelper.lamda / CMSHelper.muy), 0);
                    datacenter0.setHasMiddle(hasMiddle);


                    //Third step: Create Broker
                    DatacenterBroker broker = CMSHelper.createBroker();

                    int brokerId = broker.getId();

                    // Sixth step: Starts the simulation
                    double lastclock = CloudSim.startSimulation();
                    // Final step: Print results when simulation is over
                    List<Cloudlet> newList = broker.getCloudletReceivedList();

                    CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                    Log.printLine();
                    Log.printLine();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                    Log.printLine("total time simulate: " + lastclock);
                    Log.printLine("(without middle) mean waitting time: " + ((CMSBroker) broker).getMeanWaittingTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

                    Log.printLine("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                    Log.printLine("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                    Log.printLine("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                    Log.printLine("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                    Log.printLine("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                    Log.printLine("total job: " + CMSHelper.getCloudletid());
                    Log.printLine("**** total job lost: " + datacenter0.getNumberOfJobLost());
                    Log.printLine("**** ti le job lost = joblost / numberofjob: "+datacenter0.getNumberOfJobLost()/((CMSBroker) broker).getNumberOfJob());
                    Log.printLine("total vm: " + CMSHelper.getVmid());
                    Log.printLine();

                    meanWaittimeNoMiddle[i] = ((CMSBroker) broker).getMeanWaittingTime();
                    meanNumberOnServerNoMidle[i] =datacenter0.getMeanNumberOnServer();
                    meanNumberSetupServerNoMidle[i] = datacenter0.getMeanNumberSetupServer();

//                Log.printLine(CMSHelper.getWaittingTime(newList));

                } catch (Exception e) {
                    e.printStackTrace();
                    Log.printLine("The simulation has been terminated due to an unexpected error");
                }

                //--------------------------------------- bo phan nay di doi voi infinite queue------------
            */
                    }


                    // in ket qua: voi h = h[j]
                    // ket qua co the copy vao matlab de ve
                    FileWriter fw = null;
                    System.out.println();
                    try {
                        fw = new FileWriter("results_CFQNS_no_stag_alpha_" + CFQNSHelper.alpha + "_capacity_"
                                + CFQNSHelper.jobsqueuecapacity + "_muy_" + CFQNSHelper.muy + "_thrUP_" + ((double) CFQNSHelper.jobsqueuethresholdup) / ((double) CFQNSHelper.jobsqueuecapacity)
                                + "_thrDown_" + ((double) CFQNSHelper.jobsqueuethresholddown) / ((double) CFQNSHelper.jobsqueuecapacity) + "_timeinitqueue_" + hasTimeInitQueue + ".txt");
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    fw.write("\n");
                    System.out.println("--------------------------------------");
                    fw.write("--------------------------------------\n");
                    fw.write("alpha = " + alpha[j] + "\n");
                    fw.write("\n");
                    System.out.println("close all");
                    fw.write("close all\n");

                    System.out.print("lamda = [");
                    fw.write("lamda = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", lamdaarray[i]);
                        fw.write(lamdaarray[i] + ", ");
                    }
                    System.out.printf("%.2f ];", lamdaarray[n - 1]);
                    fw.write(lamdaarray[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean waitting time = [");
                    fw.write("mean_waitting_time" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanWaittime[i]);
                        fw.write(meanWaittime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanWaittime[n - 1]);
                    fw.write(meanWaittime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean response time = [");
                    fw.write("mean_response_time" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanResponsetime[i]);
                        fw.write(meanResponsetime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanResponsetime[n - 1]);
                    fw.write(meanResponsetime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number middle server = [");
                    fw.write("mean_number_of_middle_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberMiddleServer[i]);
                        fw.write(meanNumberMiddleServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberMiddleServer[n - 1]);
                    fw.write(meanNumberMiddleServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number setup server = [");
                    fw.write("mean_number_of_setup_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberSetupServer[i]);
                        fw.write(meanNumberSetupServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberSetupServer[n - 1]);
                    fw.write(meanNumberSetupServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number On server = [");
                    fw.write("mean_number_of_on_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberOnServer[i]);
                        fw.write(meanNumberOnServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberOnServer[n - 1]);
                    fw.write(meanNumberOnServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number Off to Middle server = [");
                    fw.write("mean_number_of_off_to_middle_server" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberOffToMiddleServer[i]);
                        fw.write(meanNumberOffToMiddleServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberOffToMiddleServer[n - 1]);
                    fw.write(meanNumberOffToMiddleServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number turned off = [");
                    fw.write("mean_number_turned_off" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberONTurnoff[i]);
                        fw.write(numberONTurnoff[i] + ", ");
                    }
                    System.out.print(" ," + numberONTurnoff[n - 1]);
                    fw.write(numberONTurnoff[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("max number of queue = [");
                    fw.write("max_number_of_queue" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberOfQueue[i]);
                        fw.write(numberOfQueue[i] + ", ");
                    }
                    System.out.print(" ," + numberOfQueue[n - 1]);
                    fw.write(numberOfQueue[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("time next = [");
                    fw.write("time_next" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + timenextlist[i]);
                        fw.write(timenextlist[i] + ", ");
                    }
                    System.out.print(" ," + timenextlist[n - 1]);
                    fw.write(timenextlist[n - 1] + "];\n");


                    System.out.print("job lost ratio = [");
                    fw.write("job_lost_ratio"+CFQNSHelper.jobsqueuecapacity+" = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + jobLostRatio[i]);
                        fw.write(jobLostRatio[i] + ", ");
                    }
                    System.out.print(" ," + jobLostRatio[n - 1]);
                    fw.write(jobLostRatio[n - 1] + "];\n");


                    fw.write("\n_____________________________\n\n");
                    System.out.println();

                    //------------ ko co middle-------------
/*
            Log.print("mean Waittime No Middle = [");fw.write("mean_waitting_time_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanWaittimeNoMiddle[i]);fw.write(meanWaittimeNoMiddle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanWaittimeNoMiddle[n-1]);fw.write(meanWaittimeNoMiddle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number setup server no middle = [");fw.write("mean_number_of_setup_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberSetupServerNoMidle[i]);fw.write(meanNumberSetupServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberSetupServerNoMidle[n-1]);fw.write(meanNumberSetupServerNoMidle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number On server no middle = [");fw.write("mean_number_of_on_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberOnServerNoMidle[i]);fw.write(meanNumberOnServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberOnServerNoMidle[n-1]);fw.write(meanNumberOnServerNoMidle[n-1] + "];\n");
            Log.printLine();
*/


                    System.out.println();

                    // in code ve:
                    fw.write("plot(lamda,mean_waitting_time,'r',lamda,mean_waitting_time_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean waitting time');\n");
                    fw.write("legend('with middle','no middle');\n");
                    fw.write("ylim([0 max(max(mean_waitting_time),max(mean_waitting_time_no_middle))*10/9]);");

//            fw.write("ylim([0 18000]);\n");
                    fw.write("figure(2);\n");
                    fw.write("plot(lamda,mean_number_of_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number of middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_middle_server)*10/9]);");

                    fw.write("figure(3);\n");
                    fw.write("plot(lamda,mean_number_of_off_to_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number off to middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_off_to_middle_server)*10/9]);");

                    // ------ve do thi mean number of ON server va Setup server
                    fw.write("figure(4);\n");
                    fw.write("plot(lamda,mean_number_of_setup_server,'r',lamda,mean_number_of_setup_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number setup server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_setup_server),max(mean_number_of_setup_server_no_middle))*10/9]);");

                    fw.write("figure(5);\n");
                    fw.write("plot(lamda,mean_number_of_on_server,'r',lamda,mean_number_of_on_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number on server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_on_server),max(mean_number_of_on_server_no_middle))*10/9]);\n");
//            fw.write("ylim([0 1000]);\n");
                    System.out.println("--------------------------------------");
                    fw.write("--------------------------------------\n");
                    fw.close();
                }

            }
        }
    }

    public static void chayvoilamdathaydoisinglequeuekomiddle() throws IOException {
        // file luu kq


        // // co dinh alpha, lamda thay doi

        boolean hasTimeInitQueue = true; // thay doi cai nay phai thay doi ham init() trong file datacenter

        double[] lamdaarray = {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20};
        int n = lamdaarray.length;

        double[] meanWaittimeNoMiddle = new double[n];
        double[] meanNumberSetupServerNoMidle = new double[n];
        double[] meanNumberOnServerNoMidle = new double[n];

        double[] meanWaittime = new double[n];
        double[] meanResponsetime = new double[n];
        int[] numberONTurnoff = new int[n];
        int[] numberOfQueue = new int[n];
        double[] meanNumberSetupServer = new double[n];
        double[] meanNumberOnServer = new double[n];
        double[] meanNumberMiddleServer = new double[n];
//        double[] meanNumberOffToMiddleServer = new double[n];
        double[] timenextlist = new double[n];
        double[] jobLostRatio = new double[n];

        for (int indexMuy = 0; indexMuy < muy.length; indexMuy++) {
            for (int j = 0; j < alpha.length; j++) {

                for (int indexK = 0; indexK < capacity.length; indexK++) {

                    // cho lambda thay doi
                    for (int i = 0; i < lamdaarray.length; i++) {

                        // chay co middle
                        // chay voi co control middle
                        System.out.println("(without middle) Starting simulation... chay voi alpha = " + alpha[j]
                                +" muy = "+ muy[indexMuy]+ " capacity = "+capacity[indexK] + " lamda = " + lamdaarray[i]);
                        try {
                            //------------------thiet lap tham so-----------------
                            CFQNSHelper.reset();
                            CFQNSHelper.setAlpha(alpha[j]);
                            CFQNSHelper.jobsqueuecapacity = capacity[indexK];
                            CFQNSHelper.jobsqueuethresholdup = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrUP);
                            CFQNSHelper.jobsqueuethresholddown = (int) (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.thrDown);
                            CFQNSHelper.setMuy(muy[indexMuy]); // thoi gian phuc vu 1/ muy = 5
                            CFQNSHelper.setTimeOffToMiddle(200);

                            CFQNSHelper.setLamda(lamdaarray[i]);
                            CFQNSHelper.isSingleQueue = true;
//                    CMSHelper.setControlTime(200);

//                        // thay doi thoi gian thu nghiem cho phu hop voi lambda
//                        CFQNSHelper.timeStartSimulate = CFQNSHelper.timeStartSimulate / lamdaarray[i];
//                        CFQNSHelper.totalTimeSimulate = CFQNSHelper.totalTimeSimulate / lamdaarray[i];

                            boolean hasMiddle = false;

                            calculatetimenext();
                            //^^^^^^^^^^^^^^thiet lap tham so (end)^^^^^^^^^^^^^^^

                            // First step: Initialize the CloudSim package. It should be called
                            // before creating any entities.
                            int num_user = 1;   // number of cloud users
                            Calendar calendar = Calendar.getInstance();
                            boolean trace_flag = false;  // mean trace events

                            // Initialize the CloudSim library
                            CloudSim.init(num_user, calendar, trace_flag);

                            // Second step: Create Datacenters
                            //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                            CFQNSDatacenter datacenter0 = CFQNSHelper.createDatacenter("Datacenter_0");
                            datacenter0.state = CFQNSDatacenter.ON;
                            datacenter0.setStartState(0,(int) (CFQNSHelper.timeOffToMiddle/CFQNSHelper.timenext));
                            datacenter0.setHasMiddle(hasMiddle);
                            Log.printLine("main datacenter id "+datacenter0.getId());


                            //Third step: Create Broker
                            DatacenterBroker broker = CFQNSHelper.createBroker();


                            int brokerId = broker.getId();

                            // Sixth step: Starts the simulation
                            double lastclock = CloudSim.startSimulation();
                            // Final step: Print results when simulation is over
                            List<Cloudlet> newList = broker.getCloudletReceivedList();

                            CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                            System.out.println();
                            System.out.println();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                            System.out.println("total time simulate: " + lastclock);
                            System.out.println("(without middle) mean waitting time: " + ((CFQNSBroker) broker).getMeanWaittingTime());
                            System.out.println("(withouot middle) mean response time: " + ((CFQNSBroker) broker).getMeanResponseTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

//                            System.out.println("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                            System.out.println("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                            System.out.println("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                            System.out.println("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                            System.out.println("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                            System.out.println("number of job (trong khoang thoi gian xet: " + ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("**** total job lost: " + datacenter0.getNumberOfJobLost());
                            System.out.println("**** ti le job lost = joblost / numberofjob: " + datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob());
                            System.out.println("total vm: " + CFQNSHelper.getVmid());
                            System.out.println("total sub datacenter create: " + CFQNSHelper.listSubDatacenter.size());
                            System.out.println("so lan tat may ON  " + CFQNSHelper.extraCount);
                            System.out.println();


                            meanNumberMiddleServer[i] = datacenter0.getMeanMiddleServerLength();
                            meanNumberOnServer[i] = datacenter0.getMeanNumberOnServer();
                            meanNumberSetupServer[i] = datacenter0.getMeanNumberSetupServer();

//                            meanNumberOffToMiddleServer[i] = CFQNSHelper.timeOffToMiddle / CFQNSHelper.timenext;
                            timenextlist[i] = CFQNSHelper.timenext;
                            jobLostRatio[i] = datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob();

                            meanWaittime[i] = ((CFQNSBroker) broker).getMeanWaittingTime();
                            meanResponsetime[i] = ((CFQNSBroker) broker).getMeanResponseTime();
                            numberONTurnoff[i] = CFQNSHelper.extraCount;
                            numberOfQueue[i] = CFQNSHelper.listSubDatacenter.size();


//                Log.printLine(CMSHelper.getWaittingTime(newList));

                        } catch (Exception e) {
                            e.printStackTrace();
                            Log.printLine("The simulation has been terminated due to an unexpected error");
                        }

                        //--------------------------------------- bo phan nay di doi voi infinite queue------------
                /*
                // chay khong co middle

                Log.printLine("(ko co middle) Starting simulation... chay voi lamda = ");
                try {
                    //------------------thiet lap tham so-----------------
                    CMSHelper.reset();
                    CMSHelper.setLamda(lamdaarray[i]);
//                    CMSHelper.setControlTime(200);
                    CMSHelper.setAlpha(alpha[j]);
                    CMSHelper.setMuy(0.2);


                    CMSHelper.setTimeOffToMiddle(200);

                    boolean hasMiddle = false;
//                    CMSHelper.totalJobs = 4100000;

                    //------------------thiet lap tham so (end)-----------------

                    // First step: Initialize the CloudSim package. It should be called
                    // before creating any entities.
                    int num_user = 1;   // number of cloud users
                    Calendar calendar = Calendar.getInstance();
                    boolean trace_flag = false;  // mean trace events

                    // Initialize the CloudSim library
                    CloudSim.init(num_user, calendar, trace_flag);

                    // Second step: Create Datacenters
                    //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

                    CMSDatacenter datacenter0 = CMSHelper.createDatacenter("Datacenter_0");
//                    datacenter0.setStartState((int) (CMSHelper.lamda / CMSHelper.muy), 0);
                    datacenter0.setHasMiddle(hasMiddle);


                    //Third step: Create Broker
                    DatacenterBroker broker = CMSHelper.createBroker();

                    int brokerId = broker.getId();

                    // Sixth step: Starts the simulation
                    double lastclock = CloudSim.startSimulation();
                    // Final step: Print results when simulation is over
                    List<Cloudlet> newList = broker.getCloudletReceivedList();

                    CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

                    Log.printLine();
                    Log.printLine();

//                    Log.printLine("mean waitting time: " + datacenter0.getMeanWaittingTime());
                    Log.printLine("total time simulate: " + lastclock);
                    Log.printLine("(without middle) mean waitting time: " + ((CMSBroker) broker).getMeanWaittingTime());

//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

                    Log.printLine("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());
                    Log.printLine("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

                    Log.printLine("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
                    Log.printLine("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

                    Log.printLine("total time no Middle server: " + datacenter0.getTimeNoMiddle());

                    Log.printLine("total job: " + CMSHelper.getCloudletid());
                    Log.printLine("**** total job lost: " + datacenter0.getNumberOfJobLost());
                    Log.printLine("**** ti le job lost = joblost / numberofjob: "+datacenter0.getNumberOfJobLost()/((CMSBroker) broker).getNumberOfJob());
                    Log.printLine("total vm: " + CMSHelper.getVmid());
                    Log.printLine();

                    meanWaittimeNoMiddle[i] = ((CMSBroker) broker).getMeanWaittingTime();
                    meanNumberOnServerNoMidle[i] =datacenter0.getMeanNumberOnServer();
                    meanNumberSetupServerNoMidle[i] = datacenter0.getMeanNumberSetupServer();

//                Log.printLine(CMSHelper.getWaittingTime(newList));

                } catch (Exception e) {
                    e.printStackTrace();
                    Log.printLine("The simulation has been terminated due to an unexpected error");
                }

                //--------------------------------------- bo phan nay di doi voi infinite queue------------
            */
                    }


                    // in ket qua: voi h = h[j]
                    // ket qua co the copy vao matlab de ve
                    FileWriter fw = null;
                    System.out.println();
                    try {
                        fw = new FileWriter("results_CFQNS_no_stag_alpha_" + CFQNSHelper.alpha + "_capacity_"
                                + CFQNSHelper.jobsqueuecapacity + "_muy_" + CFQNSHelper.muy + "_thrUP_" + ((double) CFQNSHelper.jobsqueuethresholdup) / ((double) CFQNSHelper.jobsqueuecapacity)
                                + "_thrDown_" + ((double) CFQNSHelper.jobsqueuethresholddown) / ((double) CFQNSHelper.jobsqueuecapacity) + "_timeinitqueue_" + hasTimeInitQueue + ".txt");
                    } catch (IOException e) {
                        e.printStackTrace();
                    }
                    fw.write("\n");
                    System.out.println("---------without middle------------------");

                    fw.write("alpha = " + alpha[j] + "\n");
                    fw.write("\n");
                    fw.write("--------------------------------------\n");

                    System.out.println("close all");
                    fw.write("close all\n");

                    System.out.print("lamda = [");
                    fw.write("lamda = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", lamdaarray[i]);
                        fw.write(lamdaarray[i] + ", ");
                    }
                    System.out.printf("%.2f ];", lamdaarray[n - 1]);
                    fw.write(lamdaarray[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean waitting time = [");
                    fw.write("mean_waitting_time_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanWaittime[i]);
                        fw.write(meanWaittime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanWaittime[n - 1]);
                    fw.write(meanWaittime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean response time = [");
                    fw.write("mean_response_time_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f, ", meanResponsetime[i]);
                        fw.write(meanResponsetime[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanResponsetime[n - 1]);
                    fw.write(meanResponsetime[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number middle server = [");
                    fw.write("mean_number_of_middle_server_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberMiddleServer[i]);
                        fw.write(meanNumberMiddleServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberMiddleServer[n - 1]);
                    fw.write(meanNumberMiddleServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number setup server = [");
                    fw.write("mean_number_of_setup_server_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberSetupServer[i]);
                        fw.write(meanNumberSetupServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberSetupServer[n - 1]);
                    fw.write(meanNumberSetupServer[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("mean number On server = [");
                    fw.write("mean_number_of_on_server_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.printf("%.2f ,", meanNumberOnServer[i]);
                        fw.write(meanNumberOnServer[i] + ", ");
                    }
                    System.out.printf("%.2f ];", meanNumberOnServer[n - 1]);
                    fw.write(meanNumberOnServer[n - 1] + "];\n");
                    System.out.println();

//                    System.out.print("mean number Off to Middle server = [");
//                    fw.write("mean_number_of_off_to_middle_server" + CFQNSHelper.jobsqueuecapacity + " = [");
//                    for (int i = 0; i < n - 1; i++) {
//                        System.out.printf("%.2f ,", meanNumberOffToMiddleServer[i]);
//                        fw.write(meanNumberOffToMiddleServer[i] + ", ");
//                    }
//                    System.out.printf("%.2f ];", meanNumberOffToMiddleServer[n - 1]);
//                    fw.write(meanNumberOffToMiddleServer[n - 1] + "];\n");
//                    System.out.println();

                    System.out.print("mean number turned off = [");
                    fw.write("mean_number_turned_off_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberONTurnoff[i]);
                        fw.write(numberONTurnoff[i] + ", ");
                    }
                    System.out.print(" ," + numberONTurnoff[n - 1]);
                    fw.write(numberONTurnoff[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("max number of queue = [");
                    fw.write("max_number_of_queue_nomiddle" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + numberOfQueue[i]);
                        fw.write(numberOfQueue[i] + ", ");
                    }
                    System.out.print(" ," + numberOfQueue[n - 1]);
                    fw.write(numberOfQueue[n - 1] + "];\n");
                    System.out.println();

                    System.out.print("time next = [");
                    fw.write("time_next" + CFQNSHelper.jobsqueuecapacity + " = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + timenextlist[i]);
                        fw.write(timenextlist[i] + ", ");
                    }
                    System.out.print(" ," + timenextlist[n - 1]);
                    fw.write(timenextlist[n - 1] + "];\n");


                    System.out.print("job lost ratio = [");
                    fw.write("job_lost_ratio_nomiddle"+CFQNSHelper.jobsqueuecapacity+" = [");
                    for (int i = 0; i < n - 1; i++) {
                        System.out.print(" ," + jobLostRatio[i]);
                        fw.write(jobLostRatio[i] + ", ");
                    }
                    System.out.print(" ," + jobLostRatio[n - 1]);
                    fw.write(jobLostRatio[n - 1] + "];\n");


                    fw.write("\n_____________________________\n\n");
                    System.out.println();

                    //------------ ko co middle-------------
/*
            Log.print("mean Waittime No Middle = [");fw.write("mean_waitting_time_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanWaittimeNoMiddle[i]);fw.write(meanWaittimeNoMiddle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanWaittimeNoMiddle[n-1]);fw.write(meanWaittimeNoMiddle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number setup server no middle = [");fw.write("mean_number_of_setup_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberSetupServerNoMidle[i]);fw.write(meanNumberSetupServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberSetupServerNoMidle[n-1]);fw.write(meanNumberSetupServerNoMidle[n-1] + "];\n");
            Log.printLine();

            Log.print("mean number On server no middle = [");fw.write("mean_number_of_on_server_no_middle = [");
            for (int i = 0; i < n-1; i++) {
                System.out.printf("%.2f ,", meanNumberOnServerNoMidle[i]);fw.write(meanNumberOnServerNoMidle[i] + ", ");
            }
            System.out.printf("%.2f ];", meanNumberOnServerNoMidle[n-1]);fw.write(meanNumberOnServerNoMidle[n-1] + "];\n");
            Log.printLine();
*/


                    System.out.println();

                    // in code ve:
                    fw.write("plot(lamda,mean_waitting_time,'r',lamda,mean_waitting_time_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean waitting time');\n");
                    fw.write("legend('with middle','no middle');\n");
                    fw.write("ylim([0 max(max(mean_waitting_time),max(mean_waitting_time_no_middle))*10/9]);");

//            fw.write("ylim([0 18000]);\n");
                    fw.write("figure(2);\n");
                    fw.write("plot(lamda,mean_number_of_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number of middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_middle_server)*10/9]);");

                    fw.write("figure(3);\n");
                    fw.write("plot(lamda,mean_number_of_off_to_middle_server,'r'); title('alpha = " + alpha[j] + "');xlabel('lamda');ylabel('mean number off to middle server');\n");
                    fw.write("ylim([0 max(mean_number_of_off_to_middle_server)*10/9]);");

                    // ------ve do thi mean number of ON server va Setup server
                    fw.write("figure(4);\n");
                    fw.write("plot(lamda,mean_number_of_setup_server,'r',lamda,mean_number_of_setup_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number setup server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_setup_server),max(mean_number_of_setup_server_no_middle))*10/9]);");

                    fw.write("figure(5);\n");
                    fw.write("plot(lamda,mean_number_of_on_server,'r',lamda,mean_number_of_on_server_no_middle,'-xb');\n");
                    fw.write("title('alpha = " + alpha[j] + "'); xlabel('lamda');ylabel('mean number on server');\n");
                    fw.write("legend('with middle','without middle');\n");
                    fw.write("ylim([0 max(max(mean_number_of_on_server),max(mean_number_of_on_server_no_middle))*10/9]);\n");
//            fw.write("ylim([0 1000]);\n");
                    System.out.println("--------------------------------------");
                    fw.write("--------------------------------------\n");
                    fw.close();
                }

            }
        }
    }

    public static void calculatetimenext() {
        //***************************************
        // thiet lap timenext trong thuat toan control middle

        // dat pi_00 = a;
        // bieu dien tat ca pi_ij theo a
        // bat dau:
        // hang 0:

        // mang luu gia tri limiting probability hang dang xet
        // cu dich den hang tiep theo thi mang lai giam di phan tu dau tien
        double[] hangtruoc = new double[CFQNSHelper.jobsqueuecapacity + 1];
        // he so
        double[] a = new double[CFQNSHelper.jobsqueuecapacity + 1];
        double[] b = new double[CFQNSHelper.jobsqueuecapacity + 1];
        // xet dong 0
        double sum = 0;
        double sum1 = 0;
        hangtruoc[0] = 1;
        sum = sum + hangtruoc[0];
        // tong cac pi_ii:
        double sum2 = hangtruoc[0];
        for (int i = 1; i < CFQNSHelper.jobsqueuecapacity; i++) {
            hangtruoc[i] = hangtruoc[i - 1] * CFQNSHelper.lamda / (CFQNSHelper.lamda + i * CFQNSHelper.alpha);
            sum = sum + hangtruoc[i];
            sum1 = sum1 + hangtruoc[i] * (i - 0);
        }
        hangtruoc[CFQNSHelper.jobsqueuecapacity] = hangtruoc[CFQNSHelper.jobsqueuecapacity - 1] * CFQNSHelper.lamda / (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.alpha);
        sum = sum + hangtruoc[CFQNSHelper.jobsqueuecapacity];

        // xet tu dong thu 1 tro di
        // pi_11:
        hangtruoc[1] = CFQNSHelper.lamda / CFQNSHelper.muy;
        sum = sum + hangtruoc[1];
        sum2 = sum2 + hangtruoc[1];
        // tinh he so:

        for (int i = 1; i < CFQNSHelper.jobsqueuecapacity; i++) { // i tu 1 den K-1
            // xet dong i:
            // tinh cac he so
            a[CFQNSHelper.jobsqueuecapacity] = (CFQNSHelper.jobsqueuecapacity - i + 1) * CFQNSHelper.alpha *
                    hangtruoc[CFQNSHelper.jobsqueuecapacity] / ((CFQNSHelper.jobsqueuecapacity - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy);

            b[CFQNSHelper.jobsqueuecapacity] = CFQNSHelper.lamda / ((CFQNSHelper.jobsqueuecapacity - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy);

            for (int j = CFQNSHelper.jobsqueuecapacity - 1; j > i; j--) {
                a[j] = (i * CFQNSHelper.muy * a[j + 1] + (j - i + 1) * CFQNSHelper.alpha * hangtruoc[j])
                        / (CFQNSHelper.lamda + (j - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy - i * CFQNSHelper.muy * b[j + 1]);

                b[j] = CFQNSHelper.lamda / (CFQNSHelper.lamda + (j - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy - i * CFQNSHelper.muy * b[j + 1]);
            }

            // tinh limiting probability cho dong thu i ke tu pi_i,i+1
            double temp = 0;
            for (int j = i + 1; j < CFQNSHelper.jobsqueuecapacity + 1; j++) {
                hangtruoc[j] = a[j] + b[j] * hangtruoc[j - 1];
                temp = temp + (j - i) * CFQNSHelper.alpha * hangtruoc[j];
                sum = sum + hangtruoc[j];
                sum1 = sum1 + hangtruoc[j] * (j - i);
            }

            // tinh limiting probability pi_i+1,i+1
            hangtruoc[i + 1] = temp / ((i + 1) * CFQNSHelper.muy);
            sum = sum + hangtruoc[i + 1];
            sum2 = sum2 + hangtruoc[i + 1];

        }

        // gia tri cua pi_00 = 1/sum
        //  => tong cac pi_ii = sum2/sum
        // tinh timenext:
        CFQNSHelper.timenext = 1 / (CFQNSHelper.alpha * sum1 / sum);
        System.out.println("time next: " + CFQNSHelper.timenext);

//        CFQNSHelper.timenext = 1/0.136;
//        System.out.println("time next: "+ CFQNSHelper.timenext);
    }


    public static void test() {

        // chay voi co control middle
        Log.printLine("Starting simulation... chay voi lamda = ");
        try {
            //------------------thiet lap tham so-----------------
            CFQNSHelper.reset();
            CFQNSHelper.setLamda(5);
//                    CMSHelper.setControlTime(200);
            CFQNSHelper.setAlpha(0.01);
            CFQNSHelper.setMuy(0.01); // thoi gian phuc vu 1/ muy = 5


            CFQNSHelper.setTimeOffToMiddle(200);
            boolean hasMiddle = true;

//                    CMSHelper.totalJobs = 100100000;

            calculatetimenext();
            //------------------thiet lap tham so (end)-----------------

            // First step: Initialize the CloudSim package. It should be called
            // before creating any entities.
            int num_user = 1;   // number of cloud users
            Calendar calendar = Calendar.getInstance();
            boolean trace_flag = false;  // mean trace events

            // Initialize the CloudSim library
            CloudSim.init(num_user, calendar, trace_flag);

            // Second step: Create Datacenters
            //Datacenters are the resource providers in CloudSim. We need at list one of them to run a CloudSim simulation

            CFQNSDatacenter datacenter0 = CFQNSHelper.createDatacenter("Datacenter_0");
            datacenter0.state = CFQNSDatacenter.ON;
//                    datacenter0.setStartState((int) (CMSHelper.lamda / CMSHelper.muy), 0);
            datacenter0.setHasMiddle(hasMiddle);


            //Third step: Create Broker
            DatacenterBroker broker = CFQNSHelper.createBroker();

            int brokerId = broker.getId();

            // Sixth step: Starts the simulation
            double lastclock = CloudSim.startSimulation();
            // Final step: Print results when simulation is over
            List<Cloudlet> newList = broker.getCloudletReceivedList();

            CloudSim.stopSimulation();

//                CMSHelper.printCloudletList(newList);

            Log.printLine();
            Log.printLine();

            Log.printLine("total time simulate: " + lastclock);
            Log.printLine("mean waitting time: " + ((CFQNSBroker) broker).getMeanWaittingTime());
            Log.printLine("mean response time: " + ((CFQNSBroker) broker).getMeanResponseTime());


//                    double t = 0;
//                    for(int index = 100000; index < ((CMSBroker) broker).listJob.size(); index++){
//                        t = t + ((CMSBroker) broker).listJob.get(index).getTimeStartExe()-
//                                ((CMSBroker) broker).listJob.get(index).getTimeCreate();
//                    }
//                    t = t/((CMSBroker) broker).listJob.size();
//                    Log.printLine("mean waitting time 2: "+t);
//                    Log.printLine("mean waitting time 2: of "+ newList.size()+" : " + CMSHelper.getMeanWaittingTime(newList));

//                    Log.printLine("mean jobs queue length : " + datacenter0.getMeanJobsQueueLength());

            Log.printLine("mean Middle server Length: " + datacenter0.getMeanMiddleServerLength());

            Log.printLine("mean setup server Length: " + datacenter0.getMeanNumberSetupServer());
            Log.printLine("mean ON server Length: " + datacenter0.getMeanNumberOnServer());

            Log.printLine("total time no Middle server: " + datacenter0.getTimeNoMiddle());

            Log.printLine("total job: " + CFQNSHelper.getCloudletid());
            Log.printLine("**** total job lost: " + datacenter0.getNumberOfJobLost());
            Log.printLine("**** ti le job lost = joblost / numberofjob: " + datacenter0.getNumberOfJobLost() / ((CFQNSBroker) broker).getNumberOfJob());

            Log.printLine("total vm: " + CFQNSHelper.getVmid());
            Log.printLine("total sub datacenter create: " + CFQNSHelper.listSubDatacenter.size());
            Log.printLine();


//                Log.printLine(CMSHelper.getWaittingTime(newList));

        } catch (Exception e) {
            e.printStackTrace();
            Log.printLine("The simulation has been terminated due to an unexpected error");
        }

    }


    public static void main(String[] args) {
//        try {
//            chayvoihthaydoi();
//        } catch (IOException e) {
//            e.printStackTrace();
//        }

        // thu tu 3 so la muy, alpha, cap
        if(args.length <3) {
            System.out.println(" ko thiet lap du thong so la muy, alpha, capacity ----> chay voi tham so mac dinh");

        }
        else {
            muy = new double[1];
            muy[0] = Double.parseDouble(args[0]);
            alpha = new double[1];
            alpha[0] = Double.parseDouble(args[1]);
            capacity = new int[1];
            capacity[0] = Integer.parseInt(args[2]);
        }
        try {
            Log.disable();
            chayvoilamdathaydoimultiqueues();
//            chayvoilamdathaydoisinglequeue();
           // chayvoilamdathaydoisinglequeuekomiddle();
        } catch (IOException e) {
            e.printStackTrace();
        }

        // test args
        for(int i=0; i< args.length;i++){
            System.out.println(args[i]);
        }

//        khaosathamcal();
//        testhamcal();

//        Log.printLine("----------K = 500---------");
//        CFQNSHelper.jobsqueuecapacity = 500;
//        test();
        //Log.printLine("----------K = 400---------");
//        test();
//        test();
//        test();
//        test();
//        test();

    }

    public static void khaosathamcal() {
        CFQNSHelper.muy = 0.2;
        CFQNSHelper.alpha = 0.01;

        CFQNSHelper.lamda = 10;
        double mangtimenext[] = new double[36];
        for (int i = 1; i < 36; i++) {
            CFQNSHelper.jobsqueuecapacity = i * 10;
            calculatetimenext();
            mangtimenext[i] = CFQNSHelper.timenext;
        }
        for (int i = 1; i < 36; i++) {
            System.out.print(mangtimenext[i] + " ,");
        }
    }

    public static void testhamcal() {
        CFQNSHelper.muy = 1;
        CFQNSHelper.alpha = 0.01;
        CFQNSHelper.jobsqueuecapacity = 50;

        for (int z = 10; z < 50; z++) {
            CFQNSHelper.lamda = z;

            // lamda chay tu 1 den 50x1
            // thiet lap timenext trong thuat toan control middle

            // dat pi_00 = a;
            // bieu dien tat ca pi_ij theo a
            // bat dau:
            // hang 0:

            // mang luu gia tri limiting probability hang dang xet
            // cu dich den hang tiep theo thi mang lai giam di phan tu dau tien
            double[] hangtruoc = new double[CFQNSHelper.jobsqueuecapacity + 1];
            // he so
            double[] a = new double[CFQNSHelper.jobsqueuecapacity + 1];
            double[] b = new double[CFQNSHelper.jobsqueuecapacity + 1];
            // xet dong 0
            double sum = 0;
            double sum1 = 0;
            double block = 0; // xac suat block = tong pi_i,i
            hangtruoc[0] = 1; // pi_0,0
            sum = sum + hangtruoc[0];

            // tong cac pi_ii:
            double sum2 = hangtruoc[0];
            // hang 0 ( hang dau tien)
            for (int i = 1; i < CFQNSHelper.jobsqueuecapacity; i++) {
                hangtruoc[i] = hangtruoc[i - 1] * CFQNSHelper.lamda / (CFQNSHelper.lamda + i * CFQNSHelper.alpha);
                sum = sum + hangtruoc[i];
                sum1 = sum1 + hangtruoc[i] * (i - 0);
            }
            hangtruoc[CFQNSHelper.jobsqueuecapacity] = hangtruoc[CFQNSHelper.jobsqueuecapacity - 1] *
                    CFQNSHelper.lamda / (CFQNSHelper.jobsqueuecapacity * CFQNSHelper.alpha);
            sum = sum + hangtruoc[CFQNSHelper.jobsqueuecapacity];
            block = block + hangtruoc[CFQNSHelper.jobsqueuecapacity];

            // xet tu dong thu 1 tro di
            // pi_11:
            hangtruoc[1] = CFQNSHelper.lamda / CFQNSHelper.muy;
            sum = sum + hangtruoc[1];
            sum2 = sum2 + hangtruoc[1];

            // tinh he so:

            for (int i = 1; i < CFQNSHelper.jobsqueuecapacity; i++) { // i tu 1 den K-1
                // xet dong i:
                // tinh cac he so
                a[CFQNSHelper.jobsqueuecapacity] = (CFQNSHelper.jobsqueuecapacity - i + 1) * CFQNSHelper.alpha *
                        hangtruoc[CFQNSHelper.jobsqueuecapacity] / ((CFQNSHelper.jobsqueuecapacity - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy);

                b[CFQNSHelper.jobsqueuecapacity] = CFQNSHelper.lamda / ((CFQNSHelper.jobsqueuecapacity - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy);

                for (int j = CFQNSHelper.jobsqueuecapacity - 1; j > i; j--) {
                    a[j] = (i * CFQNSHelper.muy * a[j + 1] + (j - i + 1) * CFQNSHelper.alpha * hangtruoc[j])
                            / (CFQNSHelper.lamda + (j - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy - i * CFQNSHelper.muy * b[j + 1]);

                    b[j] = CFQNSHelper.lamda / (CFQNSHelper.lamda + (j - i) * CFQNSHelper.alpha + i * CFQNSHelper.muy - i * CFQNSHelper.muy * b[j + 1]);
                }

                // tinh limiting probability cho dong thu i ke tu pi_i,i+1
                double temp = 0;
                for (int j = i + 1; j < CFQNSHelper.jobsqueuecapacity + 1; j++) {
                    hangtruoc[j] = a[j] + b[j] * hangtruoc[j - 1];
                    temp = temp + (j - i) * CFQNSHelper.alpha * hangtruoc[j];
                    sum = sum + hangtruoc[j];
                    sum1 = sum1 + hangtruoc[j] * (j - i);
                }
                block = block + hangtruoc[CFQNSHelper.jobsqueuecapacity];
                // tinh limiting probability pi_i+1,i+1
                hangtruoc[i + 1] = temp / ((i + 1) * CFQNSHelper.muy);
                sum = sum + hangtruoc[i + 1];
                sum2 = sum2 + hangtruoc[i + 1];


            }
            block = block + hangtruoc[CFQNSHelper.jobsqueuecapacity];
            Log.print(" " + block / sum + ",");


        }


    }


}
